<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Busca Legislativo SP</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Estilos customizados para o Slider (Range) */
        input[type=range] {
            -webkit-appearance: none; 
            background: transparent; 
            touch-action: pan-y;
            pointer-events: none;
        }
        
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            pointer-events: auto;
            height: 36px;
            width: 36px;
            border-radius: 50%;
            background: #4B5563; /* Cinza Neutro */
            cursor: grab;
            margin-top: -15px; 
            box-shadow: 0 3px 6px rgba(0,0,0,0.3);
            border: 3px solid white;
        }

        input[type=range]::-webkit-slider-runnable-track {
            width: 100%;
            height: 6px;
            cursor: pointer;
            background: #E2E8F0;
            border-radius: 3px;
        }

        input[type=range]::-moz-range-thumb {
            pointer-events: auto;
            height: 36px;
            width: 36px;
            border-radius: 50%;
            background: #4B5563;
            cursor: grab;
            box-shadow: 0 3px 6px rgba(0,0,0,0.3);
            border: 3px solid white;
        }

        .touch-action-manipulation {
            touch-action: manipulation;
        }

        /* Classes de estado para os botões das abas */
        .tab-base {
            transition: all 0.2s;
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800 font-sans min-h-screen flex flex-col items-center justify-start p-4">

    <!-- Seletor de Modo (Abas) -->
    <div class="w-full max-w-md grid grid-cols-3 gap-0 mb-2 mt-2">
        <button onclick="setMode('projetos')" id="tab-projetos" class="tab-base py-3 font-bold text-sm rounded-l-2xl border border-r-0 touch-action-manipulation">
            Projetos
        </button>
        <button onclick="setMode('normas')" id="tab-normas" class="tab-base py-3 font-bold text-sm border-l-0 border-r-0 touch-action-manipulation">
            Normas
        </button>
        <button onclick="setMode('outros')" id="tab-outros" class="tab-base py-3 font-bold text-sm rounded-r-2xl border border-l-0 touch-action-manipulation">
            Outros
        </button>
    </div>

    <div class="w-full max-w-md bg-white rounded-2xl shadow-xl p-4 space-y-4">
        
        <!-- Seção 1: Tipo -->
        <div>
            <label class="block text-sm font-medium text-gray-500 mb-2">Tipo</label>
            
            <!-- Container Botões Projetos -->
            <div id="types-projetos" class="grid grid-cols-4 gap-2">
                <button onclick="selectType('PL')" id="btn-PL" class="type-btn active-type py-3 rounded-lg font-bold text-sm border transition-all duration-200 shadow-sm touch-action-manipulation">PL</button>
                <button onclick="selectType('PDL')" id="btn-PDL" class="type-btn py-3 rounded-lg font-bold text-sm border transition-all duration-200 shadow-sm touch-action-manipulation">PDL</button>
                <button onclick="selectType('PR')" id="btn-PR" class="type-btn py-3 rounded-lg font-bold text-sm border transition-all duration-200 shadow-sm touch-action-manipulation">PR</button>
                <button onclick="selectType('PLO')" id="btn-PLO" class="type-btn py-3 rounded-lg font-bold text-sm border transition-all duration-200 shadow-sm touch-action-manipulation">PLO</button>
            </div>
            
            <!-- Container Botões Normas -->
            <div id="types-normas" class="hidden grid grid-cols-4 gap-2">
                <button onclick="selectType('Lei')" id="btn-Lei" class="type-btn py-3 rounded-lg font-bold text-sm border transition-all duration-200 shadow-sm touch-action-manipulation">Lei</button>
                <button onclick="selectType('Decreto')" id="btn-Decreto" class="type-btn py-3 rounded-lg font-bold text-sm border transition-all duration-200 shadow-sm touch-action-manipulation">Decreto</button>
                <button onclick="selectType('DecLeg')" id="btn-DecLeg" class="type-btn py-3 rounded-lg font-bold text-sm border transition-all duration-200 shadow-sm touch-action-manipulation">Dec. Leg.</button>
                <button onclick="selectType('Ato')" id="btn-Ato" class="type-btn py-3 rounded-lg font-bold text-sm border transition-all duration-200 shadow-sm touch-action-manipulation">Ato</button>
            </div>

            <!-- Container Botões Outros -->
            <div id="types-outros" class="hidden space-y-2">
                <!-- Linha 1 -->
                <div class="grid grid-cols-4 gap-2">
                    <button onclick="selectType('RPP')" id="btn-RPP" class="type-btn py-3 rounded-lg font-bold text-xs border transition-all duration-200 shadow-sm touch-action-manipulation">RPP</button>
                    <button onclick="selectType('RPS')" id="btn-RPS" class="type-btn py-3 rounded-lg font-bold text-xs border transition-all duration-200 shadow-sm touch-action-manipulation">RPS</button>
                    <button onclick="selectType('RDP')" id="btn-RDP" class="type-btn py-3 rounded-lg font-bold text-xs border transition-all duration-200 shadow-sm touch-action-manipulation">RDP</button>
                    <button onclick="selectType('RDS')" id="btn-RDS" class="type-btn py-3 rounded-lg font-bold text-xs border transition-all duration-200 shadow-sm touch-action-manipulation">RDS</button>
                </div>
                <!-- Linha 2 -->
                <div class="grid grid-cols-3 gap-2">
                    <button onclick="selectType('MOC')" id="btn-MOC" class="type-btn py-3 rounded-lg font-bold text-xs border transition-all duration-200 shadow-sm touch-action-manipulation">MOC</button>
                    <button onclick="selectType('IND')" id="btn-IND" class="type-btn py-3 rounded-lg font-bold text-xs border transition-all duration-200 shadow-sm touch-action-manipulation">IND</button>
                    <button onclick="selectType('REC')" id="btn-REC" class="type-btn py-3 rounded-lg font-bold text-xs border transition-all duration-200 shadow-sm touch-action-manipulation">REC</button>
                    <button onclick="selectType('DOCREC')" id="btn-DOCREC" class="type-btn py-3 rounded-lg font-bold text-xs border transition-all duration-200 shadow-sm touch-action-manipulation">DOCREC</button>
                    <button onclick="selectType('RSC')" id="btn-RSC" class="type-btn py-3 rounded-lg font-bold text-xs border transition-all duration-200 shadow-sm touch-action-manipulation">RSC</button>
                    <button onclick="selectType('ANU')" id="btn-ANU" class="type-btn py-3 rounded-lg font-bold text-xs border transition-all duration-200 shadow-sm touch-action-manipulation">ANU</button>
                </div>
            </div>
        </div>

        <!-- Seção 2: Ano (Slider + Botões) -->
        <!-- Adicionado ID "section-year" para controle via JS -->
        <div id="section-year">
            <div class="flex justify-between items-end mb-2">
                <label class="text-sm font-medium text-gray-500">Ano</label>
                <span id="yearDisplay" class="text-2xl font-bold text-gray-700">...</span>
            </div>
            <div class="relative w-full h-10 flex items-center">
                <input type="range" id="yearSlider" class="w-full">
            </div>
            <!-- Botões Granulares de Ano -->
            <div class="flex justify-between items-center mt-1">
                <button onclick="adjustYear(-1)" class="w-10 h-10 flex items-center justify-center text-gray-600 bg-gray-100 hover:bg-gray-200 rounded-full active:scale-90 transition-transform touch-action-manipulation font-bold text-xl">
                    −
                </button>
                <button onclick="adjustYear(1)" class="w-10 h-10 flex items-center justify-center text-gray-600 bg-gray-100 hover:bg-gray-200 rounded-full active:scale-90 transition-transform touch-action-manipulation font-bold text-xl">
                    +
                </button>
            </div>
        </div>

        <!-- Seção 3: Número (Input + Botões + Sliders) -->
        <div class="bg-gray-50 p-4 rounded-xl border border-gray-200">
            <div class="flex justify-between items-center mb-2">
                <label class="block text-xs uppercase font-bold text-gray-400 tracking-wider">Número</label>
                <!-- Badge de Ano Automático (Visível apenas em Normas) -->
                <span id="autoYearBadge" class="hidden text-xs font-bold text-white bg-purple-500 px-2 py-0.5 rounded-full shadow-sm">
                    Ano: <span id="autoYearValue">...</span>
                </span>
            </div>
            
            <div class="relative flex items-center mb-4">
                <button onclick="adjustNumber(-1)" class="absolute left-2 w-12 h-12 flex items-center justify-center text-gray-500 hover:bg-gray-200 rounded-full active:scale-90 transition-transform z-10 touch-action-manipulation font-bold text-2xl pb-1">
                    −
                </button>
                
                <input type="tel" id="projectNumber" pattern="[0-9]*" inputmode="numeric" placeholder="0" 
                    class="w-full text-center text-4xl font-black py-2 px-14 bg-white border border-gray-200 rounded-lg focus:ring-4 focus:ring-gray-200 focus:border-gray-400 outline-none transition-all text-gray-800 shadow-sm">
                
                <button onclick="adjustNumber(1)" class="absolute right-2 w-12 h-12 flex items-center justify-center text-gray-500 hover:bg-gray-200 rounded-full active:scale-90 transition-transform z-10 touch-action-manipulation font-bold text-2xl pb-1">
                    +
                </button>
            </div>

            <div class="space-y-4">
                <div>
                    <div class="flex justify-between text-xs text-gray-400 mb-1 px-1">
                        <span>0</span>
                        <span id="label-macro" class="font-bold text-gray-600">Centenas</span>
                        <span id="max-macro-display">2000</span>
                    </div>
                    <input type="range" id="sliderMacro" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer">
                </div>

                <div id="container-mid" class="hidden">
                    <div class="flex justify-between text-xs text-gray-400 mb-1 px-1">
                        <span>0</span>
                        <span class="font-bold text-gray-600">Centenas</span>
                        <span>900</span>
                    </div>
                    <input type="range" id="sliderMid" min="0" max="9" value="0" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer">
                </div>

                <div>
                    <div class="flex justify-between text-xs text-gray-400 mb-1 px-1">
                        <span>0</span>
                        <span id="label-micro" class="font-bold text-gray-600">Unidades</span>
                        <span id="max-micro-display">99</span>
                    </div>
                    <input type="range" id="sliderMicro" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer">
                </div>
            </div>
        </div>

        <div id="errorMsg" class="hidden text-center text-red-500 text-sm font-medium bg-red-50 p-2 rounded-lg">
            Por favor, selecione ou digite o número.
        </div>

        <!-- Seção 4: Botões de Ação -->
        <div class="grid grid-cols-1 gap-3 pt-2">
            <!-- Botões Projetos -->
            <div id="actions-projetos" class="grid gap-3">
                <button onclick="openUrl('splegis')" class="w-full bg-blue-600 hover:bg-blue-700 active:bg-blue-800 text-white font-bold py-4 rounded-xl shadow-lg transform active:scale-[0.98] transition-all flex items-center justify-center gap-2 touch-action-manipulation">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                    </svg>
                    Abrir no SPLegis
                </button>
                <!-- Botão SPLegis INTRA (Projetos) -->
                <button onclick="openUrl('splegis_intra')" class="w-full bg-blue-800 hover:bg-blue-900 active:bg-blue-950 text-white font-bold py-4 rounded-xl shadow-lg transform active:scale-[0.98] transition-all flex items-center justify-center gap-2 touch-action-manipulation">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" />
                    </svg>
                    Abrir no SPLegis Intra
                </button>
                <button onclick="openUrl('portal')" class="w-full bg-blue-500 hover:bg-blue-600 active:bg-blue-700 text-white font-bold py-4 rounded-xl shadow-lg transform active:scale-[0.98] transition-all flex items-center justify-center gap-2 touch-action-manipulation">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 01-9 9m9-9a9 9 0 00-9-9m9 9H3m9 9a9 9 0 01-9-9m9 9c1.657 0 3-4.03 3-9s-1.343-9-3-9m0 18c-1.657 0-3-4.03-3-9s1.343-9 3-9m-9 9a9 9 0 019-9" />
                    </svg>
                    Abrir no Portal
                </button>
            </div>

            <!-- Botões Normas -->
            <div id="actions-normas" class="hidden grid gap-3">
                <button onclick="openUrl('plp')" class="w-full bg-purple-600 hover:bg-purple-700 active:bg-purple-800 text-white font-bold py-4 rounded-xl shadow-lg transform active:scale-[0.98] transition-all flex items-center justify-center gap-2 touch-action-manipulation">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253" />
                    </svg>
                    Abrir no PLP
                </button>
            </div>
            
             <!-- Botões Outros -->
            <div id="actions-outros" class="hidden grid gap-3">
                <button onclick="openUrl('splegis')" class="w-full bg-orange-600 hover:bg-orange-700 active:bg-orange-800 text-white font-bold py-4 rounded-xl shadow-lg transform active:scale-[0.98] transition-all flex items-center justify-center gap-2 touch-action-manipulation">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                    </svg>
                    Abrir no SPLegis
                </button>
                <!-- Botão SPLegis INTRA (Outros) -->
                <button onclick="openUrl('splegis_intra')" class="w-full bg-orange-800 hover:bg-orange-900 active:bg-orange-950 text-white font-bold py-4 rounded-xl shadow-lg transform active:scale-[0.98] transition-all flex items-center justify-center gap-2 touch-action-manipulation">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" />
                    </svg>
                    Abrir no SPLegis Intra
                </button>
            </div>
        </div>

    </div>

    <script>
        // Mapeamento de Numeração (Leis, Decretos e Atos)
        const NORMA_RANGES = {
            'Lei': [
                { year: 2026, min: 18379, max: 99999 },
                { year: 2025, min: 18223, max: 18378 },
                { year: 2024, min: 18067, max: 18222 },
                { year: 2023, min: 17881, max: 18066 },
                { year: 2022, min: 17731, max: 17880 },
                { year: 2021, min: 17545, max: 17730 },
                { year: 2020, min: 17258, max: 17544 },
                { year: 2019, min: 17022, max: 17257 },
                { year: 2018, min: 16780, max: 17021 },
                { year: 2017, min: 16609, max: 16779 },
                { year: 2016, min: 16316, max: 16608 },
                { year: 2015, min: 16100, max: 16315 },
                { year: 2014, min: 15951, max: 16099 },
                { year: 2013, min: 15578, max: 15950 },
                { year: 2012, min: 15520, max: 15577 },
                { year: 2011, min: 15357, max: 15519 },
                { year: 2010, min: 15091, max: 15356 },
                { year: 2009, min: 14873, max: 15090 },
                { year: 2008, min: 14662, max: 14872 },
                { year: 2007, min: 14259, max: 14661 },
                { year: 2006, min: 14123, max: 14258 },
                { year: 2005, min: 13944, max: 14122 },
                { year: 2004, min: 13505, max: 13943 },
                { year: 2003, min: 13474, max: 13504 },
                { year: 2002, min: 13257, max: 13473 },
                { year: 2001, min: 13110, max: 13256 },
                { year: 2000, min: 12965, max: 13109 },
                { year: 1999, min: 12784, max: 12964 },
                { year: 1998, min: 12545, max: 12783 },
                { year: 1997, min: 12289, max: 12544 },
                { year: 1996, min: 11736, max: 12288 },
                { year: 1995, min: 11471, max: 11735 },
                { year: 1994, min: 11462, max: 11470 },
                { year: 1993, min: 11339, max: 11461 },
                { year: 1992, min: 11159, max: 11338 },
                { year: 1991, min: 10924, max: 11158 },
                { year: 1990, min: 10823, max: 10923 },
                { year: 1989, min: 10721, max: 10822 },
                { year: 1988, min: 10396, max: 10720 },
                { year: 1987, min: 10237, max: 10395 },
                { year: 1986, min: 10033, max: 10236 },
                { year: 1985, min: 9807, max: 10032 },
                { year: 1984, min: 9671, max: 9806 },
                { year: 1983, min: 9520, max: 9670 },
                { year: 1982, min: 9413, max: 9519 },
                { year: 1981, min: 9205, max: 9412 },
                { year: 1980, min: 0, max: 9204 }
            ],
            'Decreto': [
                { year: 2026, min: 64893, max: 99999 },
                { year: 2025, min: 64002, max: 64892 },
                { year: 2024, min: 63112, max: 64001 },
                { year: 2023, min: 62141, max: 63111 },
                { year: 2022, min: 60984, max: 62140 },
                { year: 2021, min: 60042, max: 60983 },
                { year: 2020, min: 59168, max: 60041 },
                { year: 2019, min: 58595, max: 59167 },
                { year: 2018, min: 58004, max: 58594 },
                { year: 2017, min: 56833, max: 58003 },
                { year: 2016, min: 56756, max: 56832 },
                { year: 2015, min: 55821, max: 56755 },
                { year: 2014, min: 54732, max: 55820 },
                { year: 2013, min: 53683, max: 54731 },
                { year: 2012, min: 52886, max: 53682 },
                { year: 2011, min: 52064, max: 52885 },
                { year: 2010, min: 51123, max: 52063 },
                { year: 2009, min: 50343, max: 51122 },
                { year: 2008, min: 49076, max: 50342 },
                { year: 2007, min: 48082, max: 49075 },
                { year: 2006, min: 46878, max: 48081 },
                { year: 2005, min: 45677, max: 46877 },
                { year: 2004, min: 44280, max: 45676 },
                { year: 2003, min: 42762, max: 44279 },
                { year: 2002, min: 41286, max: 42761 },
                { year: 2001, min: 40214, max: 41285 },
                { year: 2000, min: 38901, max: 40213 },
                { year: 1999, min: 37784, max: 38900 },
                { year: 1998, min: 37264, max: 37783 },
                { year: 1997, min: 36658, max: 37263 },
                { year: 1996, min: 0, max: 36657 }
            ],
            'Ato': [
                { year: 2026, min: 1694, max: 9999 },
                { year: 2025, min: 1654, max: 1693 },
                { year: 2024, min: 1625, max: 1653 },
                { year: 2023, min: 1564, max: 1624 },
                { year: 2022, min: 1531, max: 1563 },
                { year: 2021, min: 1502, max: 1530 },
                { year: 2020, min: 1458, max: 1501 },
                { year: 2019, min: 1420, max: 1457 },
                { year: 2018, min: 1396, max: 1419 },
                { year: 2017, min: 1356, max: 1395 },
                { year: 2016, min: 1325, max: 1355 },
                { year: 2015, min: 1290, max: 1324 },
                { year: 2014, min: 1259, max: 1289 },
                { year: 2013, min: 1209, max: 1258 },
                { year: 2012, min: 1177, max: 1208 },
                { year: 2011, min: 1131, max: 1176 },
                { year: 2010, min: 1106, max: 1130 },
                { year: 2009, min: 1042, max: 1105 },
                { year: 2008, min: 1014, max: 1041 },
                { year: 2007, min: 948, max: 1013 },
                { year: 2006, min: 912, max: 947 },
                { year: 2005, min: 865, max: 911 },
                { year: 2004, min: 834, max: 864 },
                { year: 2003, min: 788, max: 833 },
                { year: 2002, min: 752, max: 787 },
                { year: 2001, min: 692, max: 751 },
                { year: 2000, min: 667, max: 691 },
                { year: 1999, min: 637, max: 666 },
                { year: 1998, min: 608, max: 636 },
                { year: 1997, min: 561, max: 607 },
                { year: 1996, min: 536, max: 560 },
                { year: 1995, min: 521, max: 535 },
                { year: 1994, min: 478, max: 520 },
                { year: 1993, min: 428, max: 477 },
                { year: 1992, min: 378, max: 427 },
                { year: 1991, min: 336, max: 377 },
                { year: 1990, min: 287, max: 335 },
                { year: 1989, min: 237, max: 286 },
                { year: 1988, min: 219, max: 236 },
                { year: 1987, min: 201, max: 218 },
                { year: 1986, min: 189, max: 200 },
                { year: 1985, min: 164, max: 188 },
                { year: 1984, min: 148, max: 163 },
                { year: 1983, min: 124, max: 147 },
                { year: 1982, min: 103, max: 123 },
                { year: 1981, min: 89, max: 102 },
                { year: 1980, min: 72, max: 88 },
                { year: 1979, min: 48, max: 71 },
                { year: 1978, min: 34, max: 47 },
                { year: 1977, min: 21, max: 33 },
                { year: 1976, min: 0, max: 20 }
            ]
        };

        const CONFIG = {
            defaultYear: 2025,
            maxYear: 2026,
            projetos: {
                minYear: 1991,
                maxNumber: 2000,
                defaultNumber: '',
                hasMid: false, 
                macroStep: 100,
                macroLabel: 'Centenas',
                microMax: 99
            },
            normas: {
                minYear: 1976,
                maxNumber: 70000,
                defaultNumber: '18000',
                hasMid: true, 
                macroStep: 1000,
                macroLabel: 'Milhares',
                microMax: 99
            },
            outros: {
                minYear: 1991,
                maxNumber: 2300,
                defaultNumber: '',
                hasMid: false, 
                macroStep: 100,
                macroLabel: 'Centenas',
                microMax: 99
            }
        };

        let state = {
            mode: 'projetos', 
            type: 'PL',
            number: '',
            year: CONFIG.defaultYear
        };

        const spLegisCodes = { 
            'PL': 1, 'PDL': 2, 'PR': 3, 'PLO': 4,
            'RPP': 6, 'RPS': 7, 'RDP': 8, 'RDS': 13,
            'MOC': 5, 'IND': 9, 'REC': 11, 'DOCREC': 15, 'RSC': 37, 'ANU': 68
        };
        
        const plpCodes = { 'Lei': 'Lei', 'Decreto': 'DEC', 'DecLeg': 'DECLEG', 'Ato': 'Ato' };

        const yearSlider = document.getElementById('yearSlider');
        const yearDisplay = document.getElementById('yearDisplay');
        const numberInput = document.getElementById('projectNumber');
        const sliderMacro = document.getElementById('sliderMacro');
        const sliderMid = document.getElementById('sliderMid');
        const sliderMicro = document.getElementById('sliderMicro');
        const errorMsg = document.getElementById('errorMsg');
        
        const tabProjetos = document.getElementById('tab-projetos');
        const tabNormas = document.getElementById('tab-normas');
        const tabOutros = document.getElementById('tab-outros');

        const typesProjetos = document.getElementById('types-projetos');
        const typesNormas = document.getElementById('types-normas');
        const typesOutros = document.getElementById('types-outros');

        const actionsProjetos = document.getElementById('actions-projetos');
        const actionsNormas = document.getElementById('actions-normas');
        const actionsOutros = document.getElementById('actions-outros');
        
        const labelMacro = document.getElementById('label-macro');
        const labelMicro = document.getElementById('label-micro');
        const maxMacroDisplay = document.getElementById('max-macro-display');
        const maxMicroDisplay = document.getElementById('max-micro-display');
        const containerMid = document.getElementById('container-mid');
        
        // Elementos da nova seção de ano
        const sectionYear = document.getElementById('section-year');
        const autoYearBadge = document.getElementById('autoYearBadge');
        const autoYearValue = document.getElementById('autoYearValue');

        function init() {
            setMode('projetos'); 

            sliderMacro.addEventListener('input', updateFromSliders);
            sliderMid.addEventListener('input', updateFromSliders);
            sliderMicro.addEventListener('input', updateFromSliders);

            yearSlider.addEventListener('input', (e) => {
                state.year = e.target.value;
                yearDisplay.innerText = state.year;
            });

            numberInput.addEventListener('input', (e) => {
                let val = e.target.value.replace(/\D/g, '');
                const max = CONFIG[state.mode].maxNumber;
                
                if (parseInt(val) > max) val = max.toString();
                
                e.target.value = val;
                state.number = val;

                // Tenta adivinhar o ano se for Norma
                if (val && state.mode === 'normas') {
                    autoSelectYear(val);
                }

                if (val) {
                    syncSlidersFromNumber(val);
                    hideError();
                }
            });

            numberInput.addEventListener('blur', () => {
                if (!state.number) {
                    sliderMacro.value = 0;
                    sliderMid.value = 0;
                    sliderMicro.value = 0;
                }
            });
            
            numberInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    if(state.mode === 'projetos' || state.mode === 'outros') openUrl('splegis');
                    else openUrl('plp');
                    numberInput.blur();
                }
            });
        }

        // Função de Adivinhação de Ano
        function autoSelectYear(numberStr) {
            const num = parseInt(numberStr);
            const ranges = NORMA_RANGES[state.type]; 
            
            if (!ranges) return; 

            const found = ranges.find(r => num >= r.min && num <= r.max);
            
            if (found) {
                state.year = found.year;
                // Atualiza sliders (mesmo ocultos) para manter consistência
                yearSlider.value = found.year;
                yearDisplay.innerText = found.year;
                
                // Atualiza o Badge
                autoYearValue.innerText = found.year;
            } else {
                 autoYearValue.innerText = "...";
            }
        }

        function adjustYear(delta) {
            let val = parseInt(state.year);
            const min = CONFIG[state.mode].minYear;
            const max = CONFIG.maxYear;

            val += delta;

            if (val < min) val = min;
            if (val > max) val = max;

            state.year = val;
            yearSlider.value = val;
            yearDisplay.innerText = val;
        }

        function adjustNumber(delta) {
            let val = parseInt(state.number || 0);
            const max = CONFIG[state.mode].maxNumber;
            
            val += delta;
            
            if (val < 0) val = 0;
            if (val > max) val = max;
            
            state.number = val.toString();
            numberInput.value = val;

            // Trigger "Adivinhação" também nos botões +/-
            if (state.mode === 'normas' && val > 0) {
                autoSelectYear(val.toString());
            }
            
            if (val > 0) {
                syncSlidersFromNumber(val);
                hideError();
            } else {
                if (val === 0) {
                    syncSlidersFromNumber(0);
                }
            }
        }

        function setMode(mode) {
            state.mode = mode;
            const settings = CONFIG[mode];
            
            toggleUI(mode);
            
            if(mode === 'projetos') selectType('PL');
            else if(mode === 'normas') selectType('Lei');
            else if(mode === 'outros') selectType('RPP');

            yearSlider.min = settings.minYear;
            yearSlider.max = CONFIG.maxYear;
            yearSlider.value = CONFIG.defaultYear;
            yearDisplay.innerText = CONFIG.defaultYear;
            state.year = CONFIG.defaultYear;
            
            configureNumberSliders(mode);
            
            state.number = settings.defaultNumber;
            numberInput.value = state.number;
            
            // Se entrar em normas com número pré-definido, calcula ano
            if(mode === 'normas' && state.number) {
                 autoSelectYear(state.number);
            }
            
            if (state.number) {
                syncSlidersFromNumber(state.number);
                hideError();
            } else {
                sliderMacro.value = 0;
                sliderMid.value = 0;
                sliderMicro.value = 0;
            }
        }

        // Lógica de Classes das Abas e UI
        function toggleUI(activeMode) {
            // Estilos Básicos (Inativo)
            const inactiveClass = "bg-white text-gray-600 border-gray-200";
            
            // Estilos Ativos por Cor
            const activeBlue = "bg-blue-600 text-white border-blue-600";
            const activePurple = "bg-purple-600 text-white border-purple-600";
            const activeOrange = "bg-orange-600 text-white border-orange-600";

            // Limpa tudo para inativo primeiro
            tabProjetos.className = `tab-base py-3 font-bold text-sm rounded-l-2xl border border-r-0 touch-action-manipulation ${inactiveClass}`;
            tabNormas.className = `tab-base py-3 font-bold text-sm border-l-0 border-r-0 touch-action-manipulation ${inactiveClass}`;
            tabOutros.className = `tab-base py-3 font-bold text-sm rounded-r-2xl border border-l-0 touch-action-manipulation ${inactiveClass}`;

            // Reset Visibilidade
            typesProjetos.classList.add('hidden');
            typesNormas.classList.add('hidden');
            typesOutros.classList.add('hidden');
            actionsProjetos.classList.add('hidden');
            actionsNormas.classList.add('hidden');
            actionsOutros.classList.add('hidden');
            containerMid.classList.add('hidden');
            
            // Reset Seção de Ano e Badge (Padrão: mostrar ano, esconder badge)
            sectionYear.classList.remove('hidden');
            autoYearBadge.classList.add('hidden');

            // Aplica Ativo
            if (activeMode === 'projetos') {
                tabProjetos.className = `tab-base py-3 font-bold text-sm rounded-l-2xl border border-r-0 touch-action-manipulation ${activeBlue}`;
                typesProjetos.classList.remove('hidden');
                actionsProjetos.classList.remove('hidden');
            } 
            else if (activeMode === 'normas') {
                tabNormas.className = `tab-base py-3 font-bold text-sm border-l-0 border-r-0 touch-action-manipulation ${activePurple}`;
                typesNormas.classList.remove('hidden');
                actionsNormas.classList.remove('hidden');
                containerMid.classList.remove('hidden');
                
                // ESCONDER SEÇÃO DE ANO E MOSTRAR BADGE
                // Essa lógica será refinada no selectType para o DecLeg
                sectionYear.classList.add('hidden');
                autoYearBadge.classList.remove('hidden');
            }
            else if (activeMode === 'outros') {
                tabOutros.className = `tab-base py-3 font-bold text-sm rounded-r-2xl border border-l-0 touch-action-manipulation ${activeOrange}`;
                typesOutros.classList.remove('hidden');
                actionsOutros.classList.remove('hidden');
            }
        }

        function configureNumberSliders(mode) {
            const settings = CONFIG[mode];
            labelMacro.innerText = settings.macroLabel;
            maxMacroDisplay.innerText = settings.maxNumber;
            maxMicroDisplay.innerText = settings.microMax;
            const macroMax = Math.floor(settings.maxNumber / settings.macroStep);
            sliderMacro.max = macroMax;
            sliderMicro.max = settings.microMax;
        }

        function updateFromSliders() {
            const settings = CONFIG[state.mode];
            const macroVal = parseInt(sliderMacro.value);
            const microVal = parseInt(sliderMicro.value);
            let total = 0;

            if (settings.hasMid) {
                const midVal = parseInt(sliderMid.value);
                total = (macroVal * 1000) + (midVal * 100) + microVal;
            } else {
                total = (macroVal * 100) + microVal;
            }
            
            const finalVal = Math.min(total, settings.maxNumber);

            if (finalVal > 0) {
                state.number = finalVal.toString();
                numberInput.value = finalVal;
                
                if (state.mode === 'normas') {
                     autoSelectYear(finalVal.toString());
                }
                
                hideError();
            } else {
                state.number = '';
                numberInput.value = '';
            }
        }

        function syncSlidersFromNumber(numStr) {
            const num = parseInt(numStr);
            if (isNaN(num)) return;

            const settings = CONFIG[state.mode];
            
            if (settings.hasMid) {
                const macro = Math.floor(num / 1000);
                const remainder = num % 1000;
                const mid = Math.floor(remainder / 100);
                const micro = remainder % 100;

                sliderMacro.value = macro;
                sliderMid.value = mid;
                sliderMicro.value = micro;
            } else {
                const macro = Math.floor(num / settings.macroStep);
                const micro = num % settings.macroStep;
                
                sliderMacro.value = macro;
                sliderMicro.value = micro;
            }
        }

        function selectType(type) {
            state.type = type;
            
            const allTypes = [
                'PL', 'PDL', 'PR', 'PLO',
                'Lei', 'Decreto', 'DecLeg', 'Ato',
                'RPP', 'RPS', 'RDP', 'RDS', 'MOC', 'IND', 'REC', 'DOCREC', 'RSC', 'ANU'
            ];

            allTypes.forEach(t => {
                const btn = document.getElementById(`btn-${t}`);
                if (!btn) return;
                
                if (t === state.type) {
                    let colorClass = "bg-blue-600 border-blue-600";
                    if(state.mode === 'normas') colorClass = "bg-purple-600 border-purple-600";
                    if(state.mode === 'outros') colorClass = "bg-orange-600 border-orange-600";

                    btn.className = `type-btn w-full py-3 rounded-lg font-bold text-xs sm:text-sm border text-white shadow-md transform scale-105 transition-all duration-200 touch-action-manipulation ${colorClass}`;
                } else {
                    btn.className = "type-btn w-full py-3 rounded-lg font-bold text-xs sm:text-sm border border-gray-200 bg-white text-gray-600 hover:bg-gray-50 touch-action-manipulation";
                }
            });

            // NOVA LÓGICA DE INTERFACE PARA DECLEG (Aplica solicitação)
            if (state.mode === 'normas') {
                if (type === 'DecLeg') {
                    // DecLeg precisa de ano manual
                    sectionYear.classList.remove('hidden');
                    autoYearBadge.classList.add('hidden');
                } else {
                    // Outras normas são automáticas
                    sectionYear.classList.add('hidden');
                    autoYearBadge.classList.remove('hidden');
                    
                    // Se já tiver número digitado, recalcula o ano ao voltar para Lei/Decreto
                    if(state.number) autoSelectYear(state.number);
                }
            }
        }

        function openUrl(destination) {
            if (!state.number || state.number === "0") {
                showError();
                numberInput.focus();
                return;
            }

            let url = '';
            
            if (state.mode === 'projetos' || state.mode === 'outros') {
                if (destination === 'splegis') {
                    const code = spLegisCodes[state.type];
                    // Link de Consulta Pública
                    url = `https://splegisconsulta.saopaulo.sp.leg.br/Pesquisa/DetailsMateriaTramitacaoLegislativa?tipo=${code}&numero=${state.number}&ano=${state.year}`;
                } else if (destination === 'splegis_intra') {
                    const code = spLegisCodes[state.type];
                    // Link Interno (SPLegis)
                    url = `https://splegis.saopaulo.sp.leg.br/Pesquisa/DetailsMateriaTramitacaoLegislativa?tipo=${code}&numero=${state.number}&ano=${state.year}`;
                } else {
                    const searchExpr = `${state.type}${state.number}${state.year}`;
                    url = `https://www.saopaulo.sp.leg.br/cgi-bin/wxis.bin/iah/scripts/?IsisScript=iah.xis&lang=pt&format=detalhado.pft&base=proje&form=A&nextAction=search&indexSearch=^nTw^lTodos%20os%20campos&exprSearch=P=${searchExpr}`;
                }
            } else {
                const tipoCode = plpCodes[state.type];
                url = `https://app-plpconsulta-prd.azurewebsites.net/Forms/MostrarArquivo?TIPO=${tipoCode}&NUMERO=${state.number}&ANO=${state.year}&DOCUMENTO=Ficha`;
            }

            window.open(url, '_self');
        }

        function showError() {
            errorMsg.classList.remove('hidden');
            numberInput.classList.add('border-red-500', 'ring-2', 'ring-red-200');
            numberInput.classList.remove('border-gray-200');
        }

        function hideError() {
            errorMsg.classList.add('hidden');
            numberInput.classList.remove('border-red-500', 'ring-2', 'ring-red-200');
            numberInput.classList.add('border-gray-200');
        }

        init();
    </script>
</body>
</html>
